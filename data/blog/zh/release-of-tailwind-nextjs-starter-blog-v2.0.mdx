---
title: 'Tailwind Nextjs 启动博客模板 v2.0 发布'
date: '2023-08-05'
lastmod: '2023-08-05'
tags: ['next-js', 'tailwind', 'guide', 'feature']
draft: false
summary: 'Tailwind Nextjs 启动博客模板 v2.0 发布，使用 Nextjs App 目录和 React 服务器组件重构。了解新功能以及如何从 V1 迁移。'
images: ['/static/images/twitter-card.png']
translationOf: release-of-tailwind-nextjs-starter-blog-v2.0
---

## 引言

欢迎使用 Tailwind Nextjs 启动博客模板 v2.0。此次发布是对代码库的重大重构，以支持 Nextjs App 目录和 React 服务器组件。继续阅读以了解新功能以及如何从 V1 迁移。

<TOCInline toc={props.toc} exclude="Introduction" />

## V1 到 V2

![Github 流量](/static/images/github-traffic.png)

该模板于 2021 年 1 月首次发布，此后已被数千名用户使用。它出现在 [Next.js 模板](https://vercel.com/templates/next.js/tailwind-css-starter-blog)、[Tailwind Awesome](https://www.tailwindawesome.com/resources/tailwind-nextjs-starter-blog) 等其他列表网站上。它每天吸引 200 多名独立访客，获得 1500-2000 次页面浏览量，有 1.3k 个派生仓库和许多其他克隆。

非常感谢社区用户和贡献者使此模板取得成功！我创建了一个小型视频集锦（在清理自述文件中的列表时）来展示使用该模板创建的博客的多样性，并庆祝这一里程碑：

<video controls>
  <source
    src="https://github-production-user-asset-6210df.s3.amazonaws.com/28362229/258559849-2124c81f-b99d-4431-839c-347e01a2616c.webm"
    type="video/webm"
  />
</video>

版本 2 建立在之前版本的成功基础上，并引入了许多新功能和改进。代码库已重构以支持 Next.js App 目录和 React 服务器组件。Markdown / MDX 现在使用 Contentlayer 处理，这是一种类型安全的内容 SDK，可验证并将您的内容转换为类型安全的 JSON 数据。它与 Pliny 集成，这是一个新库，提供开箱即用的 Next.js 组件，通过分析、评论和邮件订阅来增强您的静态站点。模板中还添加了新的命令面板（⌘-k）搜索组件。

让我们深入了解 V2 中的新功能和改进。

## Next.js App 目录和 React 服务器组件

现在 [Next.js App 路由器](https://nextjs.org/docs/app) 终于稳定，并且与页面路由器在功能上基本兼容，代码库已迁移到新设置。这允许采用混合渲染方法，使用在服务器端生成的 React 服务器组件以实现更快的页面加载和更小的包大小，同时保留注入客户端 React 组件以实现交互性的能力。[^1]

随着新功能的增加，也带来了需要学习的 [新范式](https://nextjs.org/docs/getting-started/react-essentials)。我已经迁移了代码库以尽可能多地使用新功能。这包括文件夹结构的更改，将组件拆分为服务器端与客户端组件，利用服务器端数据获取，以及使用推荐的 [元数据](https://nextjs.org/docs/app/building-your-application/optimizing/metadata) API 以提高 SEO 可发现性。

虽然这在某种程度上简化了代码库，但也使从旧代码库的迁移变得更加困难。如果您正在寻找迁移，我建议从一个新模板开始，然后复制您的自定义和现有内容。有关详细信息，请参阅 [迁移建议](#migration-recommendations) 部分。

## Typescript 优先

代码库已迁移到 Typescript。虽然模板的先前版本同时提供 Javascript 和 Typescript，但我决定减少维护负担并专注于 Typescript。这也允许在 IDE 中进行更好的类型检查和代码补全。

Typescript 也是我们新的类型安全 Markdown 处理器 - Contentlayer 的完美匹配。

## Contentlayer

[Contentlayer](https://www.contentlayer.dev/) 是一个内容 SDK，可验证并将您的内容转换为类型安全的 JSON 数据，您可以轻松地将其导入到您的应用程序中。它使处理本地 markdown 或 MDX 文件变得轻而易举。这取代了 `MDX-bundler` 和我们自己的 markdown 处理工作流程。

首先，定义一个内容源，指定文档类型的名称、其所在位置以及 frontmatter 字段和应在处理过程中生成的任何其他计算字段。

```ts:contentlayer.config.ts
export const Blog = defineDocumentType(() => ({
  name: 'Blog',
  filePathPattern: 'blog/**/*.mdx',
  contentType: 'mdx',
  fields: {
    title: { type: 'string', required: true },
    date: { type: 'date', required: true },
    tags: { type: 'list', of: { type: 'string' }, default: [] },
    ...
  },
  computedFields: {
    readingTime: { type: 'json', resolve: (doc) => readingTime(doc.body.raw) },
    slug: {
      type: 'string',
      resolve: (doc) => doc._raw.flattenedPath.replace(/^.+?(\/)/, ''),
    }
    ...
  },
}))
```

然后，Contentlayer 使用我们所需的 markdown remark 或 rehype 插件处理 MDX 文件，验证 schema，生成类型定义并输出可以在我们的页面中轻松导入的 json 文件。热重载开箱即用，因此对 markdown 文件的编辑将立即在浏览器中反映！

## Pliny

模板受欢迎的很大一部分原因是其可定制性以及与分析提供商到评论解决方案等其他服务的集成。然而，这意味着即使用户不使用该功能，许多样板代码也必须与模板共存。更新和错误修复必须手动复制到用户的代码库中。

为了解决这个问题，我已经将逻辑抽象到一个单独的仓库 - [Pliny](https://github.com/timlrx/pliny)。Pliny 提供开箱即用的 Next.js 组件来增强静态站点：

- 分析
  - Google Analytics
  - Plausible Analytics
  - Simple Analytics
  - Umami Analytics
  - Posthog
- 评论
  - Disqus
  - Giscus
  - Utterances
- 邮件订阅（使用 Next 13 API 路由）
  - Buttondown
  - Convertkit
  - Email Octopus
  - Klaviyo
  - Mailchimp
  - Revue
- 带有 tailwind 样式表的命令面板搜索
  - Algolia
  - Kbar（本地搜索）
- UI 实用组件
  - Bleed
  - Newsletter / Blog Newsletter
  - Pre / Code block
  - Table of Contents

通过修改 `siteMetadata.js` 并更改适当的字段来选择您偏好的服务。例如，要从 Umami Analytics 更改为 Plausible，我们可以更改以下字段：

```diff-js:siteMetadata.js
analytics: {
-   umamiAnalytics: {
-     // 我们为此站点使用环境变量以避免其他用户克隆我们的分析 ID
-     umamiWebsiteId: process.env.NEXT_UMAMI_ID, // 例如 123e4567-e89b-12d3-a456-426614174000
-   },
+    plausibleAnalytics: {
+      plausibleDataDomain: '', // 例如 tailwind-nextjs-starter-blog.vercel.app
+    },
},
```

配置文件中的更改会自动传播到组件。无需修改模板。

在底层，Pliny 导出高级组件，如 `<Analytics analyticsConfig={analyticsConfig}/>` 和 `<Comments commentsConfig={commentsConfig}/>`，它们接收配置对象并渲染适当的组件。由于布局是在服务器端定义的，Next.js 能够使用配置对象来确定要渲染哪个组件，并仅将所需的组件包发送到客户端。

## 新搜索组件

2023 年的博客没有命令面板搜索栏怎么行？

最受欢迎的功能之一终于添加了 🎉！搜索组件支持 2 种搜索提供商 - Algolia 和 Kbar 本地搜索。

### Algolia

[Algolia Docsearch](https://docsearch.algolia.com/) 是一种流行的免费服务，在许多文档网站上使用。它会自动抓取提交索引的网站，并通过漂亮的对话框模态提供搜索结果。pliny 组件深受 Docusaurus 实现的启发，并带有与 Tailwind CSS 主题兼容的样式表。

### Kbar

[Kbar](https://github.com/timc1/kbar) 是一个快速、便携和可扩展的 cmd+k 界面。pliny 实现使用 kbar 创建本地搜索对话框。该组件加载一个 JSON 文件，默认为 `search.json`，该文件是在 contentlayer 构建过程中创建的。尝试按 ⌘-k 或 ctrl-k 查看搜索栏的实际效果！

## 样式和布局更新

### 主题

`tailwind.config.js` 已更新为尽可能使用 tailwind 排版默认值，并使用内置的暗模式支持通过 `prose-invert` 类。这取代了之前的 `prose-dark` 类和配置。

主主题颜色已从 `teal` 更新为 `pink`，主灰色主题从 `neutral` 更新为 `gray`。

Inter 现在已被 Space Grotesk 替代作为默认字体。

### 新布局

`layouts` 目录中提供的布局组件，提供了一种简单的方法来定制博客的外观和感觉。[^2]

构建一个流行模板的缺点是您开始到处看到多个相似的网站 😆。虽然鼓励用户根据自己的喜好定制布局，但提供更多可轻松切换的布局选项可以促进多样性，也许可以作为进一步定制的良好起点。

在 v2 中，我添加了一个新的文章布局 - `PostBanner`。它具有大横幅图像和居中的内容容器。查看 "[加拿大图片](/blog/pictures-of-canada)" 博客文章，该文章已更新以使用新布局。

默认的博客列表布局也已更新，包含带有博客标签的侧边栏。之前布局中的搜索栏已被新的命令面板搜索替换。要切换回旧布局，只需将使用 `ListLayoutWithTags` 组件的页面更改回原始的 `ListLayout`。

## 迁移建议

由于目录结构、设置和工具的大变化，我建议从一个新模板开始并复制现有内容，然后逐步将更改迁移到新模板。

样式更改相对较小，可以从旧的 `tailwind.config.js` 复制到新的。如果复制，则可能需要将 `prose-dark` 类添加到采用 tailwind 排版样式的组件中。请修改根布局组件中的字体导入以使用所需的选择字体。

MDX 处理管道和 schema 的更改可以轻松移植到新的 Contentlayer 设置。如果 frontmatter 字段有更改，您可以在 `contentlayer.config.ts` 中修改文档类型以包含新字段。自定义插件可以添加到 `contentlayer.config.ts` 中 `makeSource` 导出的 `remarkPlugins` 和 `rehypePlugins` 属性中。

Markdown 布局不再自动从 `layouts` 目录中获取。相反，它们必须在 `blog/[...slug]/page.tsx` 中定义的 `layouts` 对象中指定。[^3]

要移植较大的组件或页面，我建议首先通过使用 `"use client"` 指令将其指定为客户端组件。一旦它正确渲染，您可以将交互式组件（依赖 `use` 钩子的部分）拆分为客户端组件，并将剩余代码保持为服务器组件。请参阅全面的 Next.js [迁移指南](https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration#migrating-from-pages-to-app) 了解详细信息。

## 结论

我希望您喜欢 V2 中的新功能和改进。如果您有任何反馈或建议，请随时开启问题或在 [Twitter](https://twitter.com/timlrx) 上联系我。

## 支持

使用此模板？通过在 GitHub 上点赞、分享您自己的博客并在 Twitter 上提及来支持此项目，或成为项目 [赞助商](https://github.com/sponsors/timlrx)。

## 许可证

[MIT](https://github.com/timlrx/tailwind-nextjs-starter-blog/blob/main/LICENSE) © [Timothy Lin](https://www.timrlx.com)

[^1]: 以前的版本在生产构建中注入了 Preact。然而，这不再可能，因为它不支持 React 服务器组件。虽然整体包大小已增加到约 85kB，但大部分内容可以在服务器端预渲染，从而实现较低的首次内容绘制和交互时间。在整个项目中使用 React 也导致与外部库和组件的行为更加一致。

[^2]: 这与 Next.js App 目录布局不同，最好将其视为可重用的 React 容器。

[^3]: 这利用了服务器组件，通过在 markdown 文件中简单地指定布局选项并在 `layouts` 对象中进行匹配，然后用于渲染适当的布局组件。